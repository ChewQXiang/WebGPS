<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ä½ç½®ä¸Šå‚³</title> 
</head>
<body>
  <h1>ğŸ“ ä½ç½®è‡ªå‹•ä¸Šå‚³ä¸­â€¦</h1>
  <p id="status">ç­‰å¾…å®šä½ä¸­...</p> <!-- é¡¯ç¤ºç›®å‰ç‹€æ…‹ -->

  <script>
    // ä¹‹å¾Œè¦æ›´æ”¹ç‚ºé›»è…¦é€£ç·šåœ°æ–¹çš„ipä½ç½®
    const serverUrl = "http://192.168.0.101:8080/updateLocation";

    // è¨­å®šæ¯ä½ä½¿ç”¨è€…/éšŠå‹ä¸åŒçš„ ID
    const deviceId = "user003"; // æ‰‹å‹•è¨­æ¯ä¸€å€‹æˆå“¡çš„ID
    // è™•ç†å®šä½æˆåŠŸå¾Œï¼Œå°‡è³‡æ–™æ‰“åŒ…ä¸¦å‚³é€è‡³å¾Œç«¯
    function uploadLocation(position) {
      const data = {
        id: deviceId,
        lat: position.coords.latitude,     // ç·¯åº¦
        lon: position.coords.longitude,    // ç¶“åº¦
        time: new Date().toLocaleString("sv-SE", { timeZone: "Asia/Taipei" })  //æŠŠæ™‚å€è¨­åœ¨UTC+8çš„å°åŒ—æ™‚é–“
      };

      // ä½¿ç”¨ fetch å‚³é€ POST è«‹æ±‚ï¼ˆJSON æ ¼å¼ï¼‰
      fetch(serverUrl, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      })
      .then(() => {
        // ä¸Šå‚³æˆåŠŸå¾Œæ›´æ–°ç•«é¢æ–‡å­—
        document.getElementById("status").innerText =
          `å·²ä¸Šå‚³ï¼š${data.lat.toFixed(5)}, ${data.lon.toFixed(5)} (${data.time})`;
      })
      .catch(err => {
        // è‹¥ç™¼ç”ŸéŒ¯èª¤ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        document.getElementById("status").innerText = "ä¸Šå‚³å¤±æ•—ï¼š" + err;
      });
    }

    // è«‹æ±‚å–å¾—ç›®å‰ä½ç½®ï¼ŒæˆåŠŸå°±å‘¼å« uploadLocationï¼Œå¤±æ•—å°±é¡¯ç¤ºéŒ¯èª¤
    function locateAndSend() {
      navigator.geolocation.getCurrentPosition(uploadLocation, err => {
        document.getElementById("status").innerText = "å®šä½å¤±æ•—ï¼š" + err.message;
      });
    }

    // â± é é¢è¼‰å…¥å¾Œå…ˆåŸ·è¡Œä¸€æ¬¡ï¼Œç„¶å¾Œæ¯ 100 ç§’æ›´æ–°ä¸€æ¬¡
    locateAndSend();
    setInterval(locateAndSend, 100000); // å–®ä½ç‚ºæ¯«ç§’ï¼ˆ100 ç§’ = 100000 æ¯«ç§’ï¼‰
  </script>
</body>
</html>
